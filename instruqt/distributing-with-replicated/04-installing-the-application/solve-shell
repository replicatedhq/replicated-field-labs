#!/usr/bin/env bash

# use our shared library (already downloaded by track setup)
source /etc/profile.d/header.sh

# Initialize setup script with proper error handling
init_setup_script true

# Get the application slug using library function
app_slug=$(get_app_slug)

# Login to the registry
helm registry login registry.replicated.com \
  --username $(agent variable get CUSTOMER_EMAIL) \
  --password $(agent variable get REGISTRY_PASSWORD) 

# Install the application
helm install --namespace slackernews --create-namespace slackernews \
  oci://registry.replicated.com/$(agent variable get REPLICATED_APP)/slackernews \
  --set slackernews.domain=$(get_slackernews_domain) \
  --set service.type=NodePort \
  --kubeconfig /home/replicant/.kube/config
