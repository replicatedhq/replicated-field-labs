#!/usr/bin/env bash

# use our shared library with auto-download functionality
curl -s -o /etc/profile.d/header.sh https://raw.githubusercontent.com/replicatedhq/replicated-field-labs/refactor/crdant/builds-comprehensive-library/libs/header.sh
source /etc/profile.d/header.sh

# Initialize setup script with proper error handling and bootstrap waiting
init_setup_script

# Setup SSH client configuration
setup_ssh_config

# Generate RSA key for Dropbear SSH server
generate_dropbear_key

# Setup Kubernetes configuration with proper cluster server and ownership
setup_kubernetes_config "${HOME_DIR}" "https://cluster:6443"

# Download slackernews sources for the learner
cd "${HOME_DIR}"
get_slackernews
chown -R replicant "${HOME_DIR}/slackernews"
